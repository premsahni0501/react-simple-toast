{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import React, { createContext, useReducer, useContext, useEffect } from 'react';\nimport style from './Toaster.scss'\n\nconst ToastStateContext = createContext();\nconst ToastDispatchContext = createContext();\n\nfunction ToastReducer(state, action) {\n  switch (action.type) {\n    case 'show': {\n      return {\n        messages: [...state.messages, action.toast]\n      }\n    }\n    case 'remove': {\n      const { messages } = state;\n      const found = messages.filter(m => m.timestamp === action.timestamp);\n      const filtered = messages.filter(m => m.timestamp !== action.timestamp);\n      if (found.length) {\n        const toast = found[0];\n        clearTimeout(toast.timer());\n      }\n      return {\n        messages: [...filtered]\n      }\n    }\n    default: {\n      throw new Error(`Unhandled action type: ${action.type}`)\n    }\n  }\n}\nfunction ToastProvider({ children }) {\n  const [state, dispatch] = useReducer(ToastReducer, { messages: [] });\n  return (\n    <ToastStateContext.Provider value={state}>\n      <ToastDispatchContext.Provider value={dispatch}>\n        <ToastConsumer>{children}</ToastConsumer>\n      </ToastDispatchContext.Provider>\n    </ToastStateContext.Provider>\n  )\n}\n\nfunction useToastState() {\n  const context = useContext(ToastStateContext);\n  if (context === undefined) {\n    throw new Error('useToastState must be used within a ToastProvider')\n  }\n  return context\n}\nfunction useToastDispatch() {\n  const context = useContext(ToastDispatchContext);\n  if (context === undefined) {\n    throw new Error('useToastDispatch must be used within a ToastProvider')\n  }\n  return context\n}\nfunction useToastShow() {\n  const dispatch = useToastDispatch();\n  return (msg, timeout) => {\n    if (!msg) return;\n    const timestamp = Date.now();\n    const removeTimeout = () => setTimeout(() => {\n      dispatch({ type: 'remove', timestamp });\n    }, timeout || 5000);\n    const toastObj = {\n      type: 'show',\n      toast: {\n        msg,\n        timer() {\n          return removeTimeout();\n        },\n        timestamp\n      }\n    }\n    dispatch(toastObj);\n    removeTimeout()\n  }\n}\nfunction ToastConsumer({ children }) {\n  const state = useToastState()\n  console.log(state)\n  useEffect(() => {\n    const lastChild = document.querySelector('.toast-wrapper .toast:last-child');\n    if (lastChild) {\n      lastChild.scrollIntoView({\n        behavior: 'smooth'\n      })\n    }\n  }, [state])\n  return (\n    <ToastStateContext.Consumer>\n      {\n        context => {\n          if (context === undefined) {\n            throw new Error('ToastConsumer must be used within a ToastProvider')\n          }\n          const { messages } = context;\n\n          return (\n            <ToastDispatchContext.Consumer>\n              {dispatch => (\n                <div>\n                  {children}\n                  {messages.length ? (\n                    <div className={'toast-wrapper ' + style['toast-wrapper']}>\n                      {\n                        messages.map(m => (\n                          <div\n                            className={'toast ' + style['toast']}\n                            role=\"alert\"\n                            key={'_' + Math.random() * m.timestamp}>\n                            <span>{m.msg}</span>\n                            <br></br>\n                            <button\n                              className={style['toast-btn']}\n                              onClick={() => dispatch({ type: 'remove', timestamp: m.timestamp })}>\n                              &times;\n                              </button>\n                          </div>\n                        )).reverse()\n                      }\n                    </div>\n                  ) : null}\n                </div>\n              )}\n            </ToastDispatchContext.Consumer>\n          )\n        }\n      }\n    </ToastStateContext.Consumer>\n  )\n}\nfunction useToast() {\n  return [useToastState(), useToastDispatch()]\n}\n\nfunction withShowToast(WrappedComponent) {\n  return function (props) {\n    const showToast = useToastShow();\n    return <WrappedComponent {...props} showToast={showToast} />\n  }\n}\nexport { useToast, ToastProvider, ToastConsumer, useToastShow, withShowToast };"],"names":["ToastStateContext","createContext","ToastDispatchContext","ToastReducer","state","action","type","messages","toast","found","filter","m","timestamp","filtered","length","clearTimeout","timer","Error","ToastProvider","children","useReducer","dispatch","React","useToastState","context","useContext","undefined","useToastDispatch","useToastShow","msg","timeout","Date","now","removeTimeout","setTimeout","toastObj","ToastConsumer","console","log","useEffect","lastChild","document","querySelector","scrollIntoView","behavior","style","map","Math","random","reverse","useToast","withShowToast","WrappedComponent","props","showToast"],"mappings":"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"}